{"version":3,"sources":["../../../../src/copytrade/index.es6"],"names":["getLoggedInUserId","local_storage","get","id","TRADE_TYPES","code","name","getStorageName","DEFAULT_TRADE_TYPES","slice","map","m","defaultCopySettings","traderApiToken","copy_start","min_trade_stake","max_trade_stake","assets","cloneDeep","DEFAULT_ASSETS","trade_types","defaultTraderDetails","loginid","open","started","disableStart","yourCopySettings","validateYourCopySettingsData","valid","errorMessage","yourCopySettingsData","growl","error","message","updateLocalStorage","debounce","clonedScope","scope","searchToken","disable","set","GROUPED_INTRUMENTS","then","flatten","instruments","displayName","display_name","submarkets","mm","forEach","eGrp","eSubGrp","symbol","push","state","masterAssetList","groupedAssets","filter","f","refreshTraderStats","token","send","copytrading_statistics","trader_id","copyStatData","traderTokenDetails","find","traderTokens","merge","traderStatistics","win","win_view","onChangeCopytradeSettings","newOption","allowCopy","allow_copiers","set_settings","catch","e","masterTradeTypeList","onAllowCopyChangeCopierCellClick","onAllowCopyChangeTraderCellClick","onOpenChange","index","onStartedChange","newStarted","fromLocalStorage","currentTraderTokenDetails_localSto","newObj","splice","defer","settingsToSend","length","copy_stop","onRemove","toBeRemovedItem","onRefresh","trader","disableRefresh","console","onMinTradeChange","event","target","data","value","isNaN","parseInt","onMaxTradeChange","onUpdateYourSettings","notice","onTokenChange","onKeyDown","keyCode","addToken","some","tokenUserData","Error","focus","openTokenMgmt","click","initConfigWindow","root","i18n","bind","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","modal","width","copyTrade","get_settings","traderToken","close","unbind","dialog","remove","track","module_id","is_unique","init","$menuLink","moveToTop"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Created by Arnab Karmakar on 10/1/17.\n */\nimport $ from 'jquery';\nimport windows from '../windows/windows';\nimport rv from '../common/rivetsExtra';\nimport _ from 'lodash';\nimport html from 'text!./index.html';\nimport 'css!./index.css';\nimport '../common/util';\nimport liveapi from 'websockets/binary_websockets';\nimport validateToken from 'websockets/validateToken';\nimport { init as instrumentPromise } from '../instruments/instruments';\n\n// While using copy trader, this cannot be NULL\nconst getLoggedInUserId = () => local_storage.get(\"oauth\")[0].id;\n\nconst TRADE_TYPES = [{\n    code: 'CALL',\n    name: 'Rise',\n  }, {\n    code: 'CALL',\n    name: 'Higher',\n  },\n  {\n    code: 'PUT',\n    name: 'Fall',\n  },\n  {\n    code: 'PUT',\n    name: 'Lower',\n  },\n  {\n    code: 'ONETOUCH',\n    name: 'Touch',\n  },\n  {\n    code: 'NOTOUCH',\n    name: 'NoTouch',\n  },\n  {\n    code: 'EXPIRYMISS',\n    name: 'Ends Outside',\n  },\n  {\n    code: 'EXPIRYRANGE',\n    name: 'Ends Between',\n  },\n  {\n    code: 'DIGITDIFF',\n    name: 'Digits Differ',\n  },\n  {\n    code: 'DIGITMATCH',\n    name: 'Digits Match',\n  },\n  {\n    code: 'DIGITOVER',\n    name: 'Digits Over',\n  },\n  {\n    code: 'DIGITUNDER',\n    name: 'Digits Under',\n  },\n  {\n    code: 'DIGITODD',\n    name: 'Digits Odd',\n  },\n  {\n    code: 'DIGITEVEN',\n    name: 'Digits Even',\n  },\n  {\n    code: 'ASIANU',\n    name: 'Asians Up',\n  },\n  {\n    code: 'ASIAND',\n    name: 'Asians Down',\n  },\n  {\n    code: 'RANGE',\n    name: 'Stays Between',\n  },\n  {\n    code: 'UPORDOWN',\n    name: 'Goes Outside',\n  }];\n\nconst getStorageName = () => `copyTrade_${getLoggedInUserId()}`;\n\nconst DEFAULT_TRADE_TYPES = TRADE_TYPES.slice(0, 2).map(m => m.code);\n\nconst defaultCopySettings = (traderApiToken) => ({\n  copy_start: traderApiToken,\n  min_trade_stake: 10,\n  max_trade_stake: 100,\n  assets: _.cloneDeep(DEFAULT_ASSETS),\n  trade_types: _.cloneDeep(DEFAULT_TRADE_TYPES),\n});\n\nconst defaultTraderDetails = (traderApiToken, loginid) => ({\n  open: false,\n  started: false,\n  disableStart: false,\n  loginid,\n  yourCopySettings: defaultCopySettings(traderApiToken),\n});\nconst validateYourCopySettingsData = yourCopySettingsData => {\n  let valid = false;\n  let errorMessage = '';\n  if (yourCopySettingsData) {\n        if (!yourCopySettingsData.min_trade_stake ||\n          (yourCopySettingsData.min_trade_stake >= 1 && yourCopySettingsData.min_trade_stake <= 50000)) {\n          if (!yourCopySettingsData.max_trade_stake ||\n            (yourCopySettingsData.max_trade_stake >= 1 && yourCopySettingsData.max_trade_stake <= 50000)) {\n              if (yourCopySettingsData.min_trade_stake && yourCopySettingsData.max_trade_stake) {\n                if (yourCopySettingsData.min_trade_stake > yourCopySettingsData.max_trade_stake) {\n                  errorMessage = 'Min Trade Stake should be less than Max Trade Stake';\n                } else {\n                  valid = true;\n                }\n              } else {\n                valid = true;\n              }\n          } else {\n            errorMessage = 'Max Trade Stake should between 1 and 50000';\n          }\n        } else {\n          errorMessage = 'Min Trade Stake should between 1 and 50000';\n        }\n  } else {\n    errorMessage = 'Enter valid values for copy settings';\n  }\n  if (errorMessage) {\n    $.growl.error({ message: errorMessage });\n  }\n  return valid;\n};\nconst updateLocalStorage = _.debounce(scope => {\n  const clonedScope = _.cloneDeep(scope);\n  delete clonedScope.searchToken.disable;\n  local_storage.set(getStorageName(), clonedScope);\n}, 50);\n\nlet GROUPED_INTRUMENTS = null; // For nice display purpose only\nlet DEFAULT_ASSETS = null;\n//Get instrument list\ninstrumentPromise().then(instruments => {\n  GROUPED_INTRUMENTS = _.flatten(instruments.map(m => {\n    const displayName = m.display_name;\n    return m.submarkets.map(mm => ({\n      displayName: `${displayName} - ${mm.display_name}`,\n      instruments: mm.instruments,\n    }));\n  }));\n  let assets = [];\n  instruments.forEach(eGrp => {\n    eGrp.submarkets.forEach(eSubGrp => {\n      eSubGrp.instruments.forEach(({ symbol, display_name }) => {\n        assets.push({\n          code: symbol,\n          name: display_name,\n        });\n      });\n    });\n  });\n  state.masterAssetList = assets;\n  state.groupedAssets = GROUPED_INTRUMENTS;\n  // Randomly add top 2 assets in default list\n  DEFAULT_ASSETS = assets.filter(f => f.code === 'R_10').map(m => m.code);\n});\n\nconst refreshTraderStats = (loginid, token, scope) => liveapi\n  .send({\n    copytrading_statistics: 1,\n    trader_id: loginid,\n  })\n  .then(copyStatData => {\n    if (copyStatData.copytrading_statistics) {\n      const traderTokenDetails = _.find(scope.traderTokens, f =>\n        f.yourCopySettings && f.yourCopySettings.copy_start === token);\n      //Check if we already added this trader. If yes, then merge the changes\n      if (traderTokenDetails) {\n        _.merge(traderTokenDetails.traderStatistics, copyStatData.copytrading_statistics);\n      }\n      //If not added, then add this along with default yourCopySettings object\n      else {\n        scope.traderTokens.push(_.merge({\n          traderStatistics: copyStatData.copytrading_statistics,\n        }, defaultTraderDetails(token, loginid)));\n      }\n    }\n    updateLocalStorage(scope);\n  });\n\nlet win = null, win_view = null;\n\nconst onChangeCopytradeSettings = _.debounce((newOption) => {\n  state.allowCopy.allow_copiers = newOption;\n  liveapi\n    .send({\n      set_settings: 1,\n      allow_copiers: newOption,\n    })\n    .catch(e => {\n      $.growl.error({ message: e.message });\n      //revert\n      state.allowCopy.allow_copiers = (newOption == 1 ? 0 : 1);\n    });\n}, 250);\n\nconst state = {\n  //[{ code: , name: }]\n  masterAssetList: [],\n  //[{ code: , name: }]\n  masterTradeTypeList: _.cloneDeep(TRADE_TYPES),\n  groupedAssets: [],\n  allowCopy: {\n    allow_copiers: 0,\n    onAllowCopyChangeCopierCellClick: () => onChangeCopytradeSettings(0),\n    onAllowCopyChangeTraderCellClick: () => onChangeCopytradeSettings(1),\n  },\n  onOpenChange: (index) => {\n    state.traderTokens[index].open = !state.traderTokens[index].open;\n  },\n  onStartedChange: (index) => {\n    state.traderTokens[index].disableStart = true;\n    const newStarted = !state.traderTokens[index].started;\n    if (newStarted) {\n      //Start copying\n      //if started, revert back to last saved changes(in case user changed anything)\n      const fromLocalStorage = local_storage.get(getStorageName());\n      if (fromLocalStorage) {\n        const currentTraderTokenDetails_localSto = fromLocalStorage.traderTokens[index];\n        if (currentTraderTokenDetails_localSto) {\n          const newObj = {};\n          _.merge(newObj, state.traderTokens[index], currentTraderTokenDetails_localSto);\n          state.traderTokens.splice(index, 1);\n          //Have to apply this trick in order to trigger update of UI using rivetsjs.\n          _.defer(() => {\n            state.traderTokens.splice(index, 0, newObj);\n            const settingsToSend = _.cloneDeep(newObj.yourCopySettings);\n            if (!settingsToSend.min_trade_stake) delete settingsToSend.min_trade_stake;\n            if (!settingsToSend.max_trade_stake) delete settingsToSend.max_trade_stake;\n            if (!settingsToSend.assets || settingsToSend.assets.length <= 0) delete settingsToSend.assets;\n            if (!settingsToSend.trade_types || settingsToSend.trade_types.length <= 0) delete settingsToSend.trade_types;\n            liveapi\n              .send(settingsToSend)\n              .then(() => {\n                newObj.disableStart = false;\n                newObj.started = true;\n                updateLocalStorage(state);\n              })\n              .catch(e => {\n                $.growl.error({ message: e.message });\n                newObj.disableStart = false;\n                updateLocalStorage(state);\n              });\n          });\n        }\n      }\n    } else {\n      //Stop copying\n      liveapi.send({\n          copy_stop: state.traderTokens[index].yourCopySettings.copy_start\n        })\n        .then(() => {\n          state.traderTokens[index].disableStart = false;\n          state.traderTokens[index].started = false;\n          updateLocalStorage(state);\n        })\n        .catch(e => {\n          $.growl.error({ message: e.message });\n          state.traderTokens[index].disableStart = false;\n          updateLocalStorage(state);\n        });\n    }\n  },\n  onRemove: (index) => {\n    const toBeRemovedItem = state.traderTokens[index];\n    state.traderTokens.splice(index, 1);\n    updateLocalStorage(state);\n    // Gracefully delete it.\n    liveapi.send({\n      copy_stop: toBeRemovedItem.yourCopySettings.copy_start\n    })\n    .catch(e => {});\n  },\n  onRefresh: (index) => {\n    const trader = state.traderTokens[index];\n    const loginid = trader.loginid;\n    const token = trader.yourCopySettings.copy_start;\n    if (loginid && token) {\n      trader.disableRefresh = true;\n      refreshTraderStats(loginid, token, state)\n        .then(() => {\n          trader.disableRefresh = false;\n          updateLocalStorage(state);\n        })\n        .catch(e => {\n          $.growl.error({ message: 'Refresh failed'});\n          console.error(e);\n          trader.disableRefresh = false;\n          updateLocalStorage(scope);\n        });\n    }\n  },\n  onMinTradeChange: (event, scope) => {\n    const index = $(event.target).data('index');\n    const value = event.target.value;\n    if (!isNaN(parseInt(value)))\n      scope.traderTokens[index].yourCopySettings.min_trade_stake = parseInt(value);\n  },\n  onMaxTradeChange: (event, scope) => {\n    const index = $(event.target).data('index');\n    const value = event.target.value;\n    scope.traderTokens[index].yourCopySettings.max_trade_stake = value;\n  },\n  onUpdateYourSettings: (index) => {\n    if (validateYourCopySettingsData(state.traderTokens[index].yourCopySettings)) {\n      /**\n       * Make sure min_trade_stake & max_trade_stack are numeric\n       */\n      if(state.traderTokens[index].yourCopySettings.min_trade_stake)\n        state.traderTokens[index].yourCopySettings.min_trade_stake = parseInt(state.traderTokens[index].yourCopySettings.min_trade_stake);\n\n      if (state.traderTokens[index].yourCopySettings.max_trade_stake)\n        state.traderTokens[index].yourCopySettings.max_trade_stake = parseInt(state.traderTokens[index].yourCopySettings.max_trade_stake);\n\n      updateLocalStorage(state);\n      $.growl.notice({\n        message: 'Updated successfully',\n      });\n    }\n  },\n  searchToken: {\n    token: '',\n    onTokenChange: (event, scope) => scope.searchToken.token = event.target.value,\n    disable: false,\n    onKeyDown: (event, scope) => {\n      if (event.keyCode === 13) {\n        scope.searchToken.addToken(event, scope);\n      }\n    },\n    addToken: (event, scope) => {\n      //If searchToken.token is empty, do nothing\n      if (!scope.searchToken.token) {\n        $.growl.error({\n          message: 'Enter a valid trader token',\n        });\n        return;\n      }\n\n      //If already added, throw error\n      if (_.some(state.traderTokens, f => f.yourCopySettings.copy_start === scope.searchToken.token)) {\n        $.growl.error({ message: 'Token already added' });\n        return;\n      }\n\n      scope.searchToken.disable = true;\n\n      validateToken(scope.searchToken.token)\n        .then(tokenUserData => {\n          if (!tokenUserData) throw new Error('Invalid token');\n          refreshTraderStats(tokenUserData.loginid, scope.searchToken.token, scope)\n            .then(() => {\n              scope.searchToken.token = '';\n              scope.searchToken.disable = false;\n              updateLocalStorage(scope);\n            })\n            .catch(e => {\n              $.growl.error({ message: e.message });\n              scope.searchToken.disable = false;\n              updateLocalStorage(scope);\n              _.defer(() => $(event.target).focus());\n            });\n        })\n        .catch(error => {\n          $.growl.error({ message: error.message });\n          scope.searchToken.disable = false;\n          updateLocalStorage(scope);\n        });\n    },\n  },\n  /*\n   {\n     //We get this object from server - that's why the variables are named as per what server sends\n     traderStatistics: {\n       active_since:,\n       monthly_profitable_trades:,\n       yearly_profitable_trades:,\n       last_12months_profitable_trades:,\n       total_trades:,\n       trades_profitable:,\n       avg_duration:,\n       avg_profit:,\n       avg_loss:,\n       trades_breakdown:,\n       performance_probability:,\n       copiers:,\n     },\n     yourCopySettings: {\n       copy_start: <trader's API token>,\n       min_trade_stake:,\n       max_trade_stake:,\n       assets: [], // <- This should be list of instrument code(s) e.g, frxEURUSD, R_100, etc\n       trade_types: [],\n     },\n     open: false, // if this section is open\n     started: false, // If this is currently being used for copying\n     disableRefresh: false, // If refresh button clicked\n     loginid: , // login ID of trader\n   }\n   */\n  traderTokens: [],\n  openTokenMgmt: () => $('li.account ul a.token-management').click(),\n};\n\nconst initConfigWindow = () => {\n  const root = $(html).i18n();\n  win_view = rv.bind(root[0], state);\n\n  win = windows.createBlankWindow(root, {\n    title: 'Copy Trading'.i18n(),\n    resizable: true,\n    collapsable: true,\n    minimizable: true,\n    maximizable: true,\n    modal: false,\n    width: 600,\n    open: () => {\n      //Refresh all token details\n      const copyTrade = local_storage.get(getStorageName());\n      if (copyTrade) {\n        _.merge(state, copyTrade);\n        state.traderTokens = _.cloneDeep(state.traderTokens); // This is needed to trigger rivetsjs render\n      }\n\n      //Get the copy settings\n      liveapi\n        .send({ get_settings: 1 })\n        .then(({ get_settings = {} }) => state.allowCopy.allow_copiers = get_settings.allow_copiers);\n\n      //Refresh locally stored trader statistics\n      if (copyTrade) {\n        (async function () {\n          for (let traderToken of copyTrade.traderTokens) {\n            try {\n              const loginid = traderToken.loginid;\n              const token = traderToken.yourCopySettings.copy_start;\n              await refreshTraderStats(loginid, token, state);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        })();\n      }\n    },\n    close: () => {\n      win_view && win_view.unbind();\n      win && win.dialog('destroy').remove();\n      win_view = win = null;\n      // Clear tokens\n      state.traderTokens = [];\n    },\n    'data-authorized' :'true',\n  });\n  win.track({\n    module_id: 'copyTrade',\n    is_unique: true,\n    data: null,\n  });\n\n  win.dialog( 'open' );\n};\n\nexport const init = ($menuLink) => {\n  $menuLink.click(() => {\n    if (!win) initConfigWindow();\n    else win.moveToTop();\n  });\n};\n\nexport default { init }\n"]}