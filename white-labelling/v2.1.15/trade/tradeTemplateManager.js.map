{"version":3,"sources":["../../../../src/trade/tradeTemplateManager.es6"],"names":["define","$","chartWindow","rv","require","local_storage","get","set","TradeTemplateManager","root","dialog","state","init_state","append","html","i18n","view","bind","route","value","menu","templates","array","save_as_value","rename_tmpl","rename_value","current","current_tmpl","get_template","_","findIndex","t","name","update","save_as","tmpl","categories_value","capitalize","categoriy_displays_selected","save_changes","inx","push","growl","notice","message","text","open_file_selector","event","target","next","click","upload","file","files","reader","FileReader","onload","e","contents","result","data","JSON","parse","hash","random","template_type","hashCode","stringify","UserException","error","apply","unique","map","includes","readAsText","preventDefault","substring","set_template","download","remove","filter","rename","do_rename","new_name","find","hide_template_menu","confirm","action","currentTarget","confirm_prevMenu","confirm_text","confirm_yes","confirm_no","s","split","reduce","a","b","charCodeAt","binders","el","href","encodeURIComponent","attr","unbind","init"],"mappings":"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","file":"tradeTemplateManager.js","sourcesContent":["/**\n * Created by amin on July 31, 2016.\n */\ndefine(['jquery', 'charts/chartWindow', 'common/rivetsExtra'], function($, chartWindow, rv) {\n  require(['text!trade/tradeTemplateManager.html']);\n\n  if(!local_storage.get('trade-templates')) {\n    local_storage.set('trade-templates', []);\n  }\n\n  class TradeTemplateManager {\n    constructor(root, dialog) {\n      const state = this.init_state(root, dialog);\n      require(['text!trade/tradeTemplateManager.html'], html => {\n        root.append(html.i18n());\n        this.view = rv.bind(root[0], state);\n      });\n    }\n\n    init_state(root, dialog) {\n      const state = {\n        route: { value: 'menu' },\n        menu: {\n        },\n        templates: {\n          array: local_storage.get('trade-templates'),\n          save_as_value: '',\n          rename_tmpl: null,\n          rename_value: '',\n          current: null,\n        }\n      };\n      const {route, templates, menu} = state;\n\n      /* persist applied templates between page reloads */\n      const current_tmpl = dialog.get_template();\n      if(_.findIndex(templates.array, t => t.name === current_tmpl.name) !== -1) {\n        templates.current = current_tmpl;\n      }\n\n      route.update = value => {\n        route.value = value;\n      };\n\n      menu.save_as = () => {\n        const tmpl = dialog.get_template();\n        tmpl.name = `${tmpl.categories_value} ${_.capitalize(tmpl.categoriy_displays_selected)}`;\n        templates.save_as_value = tmpl.name;\n        route.update('save-as');\n      }\n\n      menu.templates = () => {\n        templates.array = local_storage.get('trade-templates'); // it can be modified from other dialogs.\n        route.update('templates');\n      }\n\n      menu.save_changes = () => {\n        const current = dialog.get_template();\n\n        const name = current.name;\n        const array = local_storage.get('trade-templates');\n        const inx = _.findIndex(array, t => t.name === name);\n        if(inx !== -1) {\n          array[inx] = current;\n        } else {\n          array.push(current);\n        }\n        local_storage.set('trade-templates', array);\n        templates.array = array;\n        templates.current = current;\n        $.growl.notice({message: $(\"<div/>\").text('Template changes saved '.i18n() + '(' + current.name + ')').html()});\n      }\n\n      menu.open_file_selector = (event) => {\n        $(event.target).next().click();\n      }\n\n      menu.upload = (event) => {\n        const file = event.target.files[0];\n        if(!file)\n          return;\n\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          const contents = e.target.result;\n          let data = null;\n          try{\n           data = JSON.parse(contents);\n           const hash = data.random;\n           const template_type = data.template_type;\n           delete data.random;\n           if(hash !== hashCode(JSON.stringify(data))){\n            throw new UserException(\"InvalidHash\");\n           }\n           delete data.template_type;\n           if(template_type !== 'trade-template') {\n            throw new UserException(\"Invalid template type.\");\n           }\n          } catch(e){\n            $.growl.error({message:\"Invalid json file.\"});\n            return;\n          }\n          templates.apply(data);\n          const array = local_storage.get('trade-templates');;\n          let unique = false,\n              file = 1,\n              name = data.name;\n          while(!unique){\n            if(array.map(t => t.name).includes(name)) {\n              name = data.name + \" (\" + file + \")\"\n              file++;\n              continue;\n            }\n            data.name = name;\n            unique = true;\n          }\n\n          array.push(data);\n          local_storage.set('trade-templates', array);\n          templates.array = array;\n          $.growl.notice({message: \"Successfully applied the template and saved it as \".i18n() + \"<b>\" + data.name + \"</b>\"});\n        }\n\n        reader.readAsText(file);\n      }\n\n      templates.save_as = (event) => {\n        event.preventDefault();\n        const name = templates.save_as_value.substring(0,20);\n        const tmpl = dialog.get_template();\n        if(tmpl) {\n          tmpl.name = name;\n          const array = local_storage.get('trade-templates');\n          if(array.map(t => t.name).includes(name)) {\n            $.growl.error({message: 'Template name already exists'.i18n() });\n            return;\n          }\n          array.push(tmpl);\n          templates.current = tmpl;\n          local_storage.set('trade-templates', array);\n          templates.array = array;\n          route.update('menu');\n          dialog.set_template(tmpl);\n        }\n      }\n\n      templates.download = (tmpl) => {\n        $.growl.notice({message: \"Downloading template as <b>\".i18n() + tmpl.name + \".json</b>\"});\n      }\n\n      templates.remove = (tmpl) => {\n        let array = local_storage.get('trade-templates');\n        templates.array = array.filter(t => t.name !== tmpl.name);\n        local_storage.set('trade-templates', templates.array);\n        if(templates.current && tmpl.name === templates.current.name) {\n          templates.current = null;\n        }\n      }\n\n      templates.rename = tmpl => {\n        templates.rename_value = tmpl.name;\n        templates.rename_tmpl = tmpl;\n        route.update('rename');\n      }\n\n      templates.do_rename = (event) => {\n        event.preventDefault();\n        const name = templates.rename_tmpl.name;\n        const new_name = templates.rename_value.substring(0,20);\n        const array = local_storage.get('trade-templates');\n        if(array.map(t => t.name).includes(new_name)) {\n            $.growl.error({message: 'Template name already exists'.i18n() });\n            return;\n        };\n        const tmpl = array.find(t => t.name === name);\n        if(tmpl) {\n          tmpl.name = new_name;\n          local_storage.set('trade-templates', array);\n          templates.array = array;\n          route.update('templates');\n\n          /* update template name in current dialog */\n          const current = dialog.get_template();\n          if(current.name == name) {\n            templates.current = current;\n            current.name = new_name;\n            dialog.set_template(current);\n          }\n        }\n      }\n\n      templates.apply = tmpl => {\n        dialog.set_template(tmpl);\n        templates.current = tmpl;\n        route.update('menu');\n        dialog.hide_template_menu();\n      }\n\n      templates.confirm = (tmpl, event) => {\n        route.update(\"confirm\");\n        const action = event.currentTarget.text;\n        templates.confirm_prevMenu = action === \"Delete\".i18n() ? \"templates\" : \"menu\";\n        templates.confirm_text = action === \"Delete\".i18n() ? \"Are you sure you want to delete template?\".i18n() : \"Are you sure you want to overwrite current template?\".i18n();\n\n        templates.confirm_yes = () => {\n          if(action === \"Delete\".i18n()) {\n            templates.remove(tmpl)\n            if(templates.current === tmpl)\n              templates.current = null;\n          }\n          else {\n            menu.save_changes();\n          }\n          templates.confirm_no();\n        }\n\n        templates.confirm_no = () => {\n          route.update(templates.confirm_prevMenu);\n        }\n      }\n\n      const hashCode = (s) => {\n        return s.split(\"\").reduce(function(a,b){a=((a<<5)-a)+b.charCodeAt(0);return a&a},0);\n      }\n\n      rv.binders.download = function(el, value) {\n        value.template_type = 'trade-template';\n        value.random = hashCode(JSON.stringify(value));\n        const href = \"data:text/plain;charset=utf-8,\" + encodeURIComponent(JSON.stringify(value));\n\n        $(el).attr(\"href\", href);\n        $(el).attr(\"download\",value.name + \".json\");\n      }\n\n      return state;\n    }\n\n    unbind() {\n      this.view && this.view.unbind();\n      this.view = null;\n    }\n  }\n\n  return {\n    init: (root, dialog) => new TradeTemplateManager(root, dialog)\n  }\n});\n"]}