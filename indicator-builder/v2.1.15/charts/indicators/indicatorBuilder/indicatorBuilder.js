"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();define(["jquery","common/rivetsExtra","text!charts/indicators/indicators.json","lodash","ddslick","jquery-growl","css!charts/indicators/indicatorBuilder/indicatorBuilder.css"],function(a,b,c,d){var e=function(){function e(a,d,f){_classCallCheck(this,e);var g=JSON.parse(c)[d],h=this.init_window(a,g,f);this.state=this.init_state(h,g,a),this.view=b.bind(h,this.state)}return _createClass(e,[{key:"init_window",value:function(b,c,d){var e=this;return a('<div>    				<table width="100%">    					<tr>			          <td colspan="2" rv-text="description">			          </td>			        </tr>			      </table>			     </div>').attr("title",c.long_display_name).dialog({autoOpen:!0,resizable:!1,width:350,height:400,modal:!0,my:"center",at:"center",of:window,dialogClass:"ind-ui-dialog",buttons:[{text:"OK",click:function(){var f=1===e.checks.length?e.checks[0]():e.checks.reduce(function(a,b){return a()&&b()});if(f){var g=e.state.options;d&&d(),a(b).highcharts().series[0].addIndicator(c.short_display_name.toLowerCase(),g),a(this).dialog("close"),e.unbind()}}},{text:"Cancel",click:function(){a(this).dialog("close"),e.unbind()}}]})}},{key:"init_state",value:function(c,e,f){var g=this,h=a(c).find("table"),i={},j=[],k={row:function l(b,c){var l=a("<tr></tr>");b&&l.append("<td><strong>"+b+"</strong></td>"),l.append(c.appendTo(a("<td></td>"))),h.append(l)},input:function(b){i.options[b.option_name]=b["default"];var c=a("<input type='number' rv-value='options."+b.option_name+" | parseInt'>");return c.attr("min",b.min).attr("max",b.max),j.push(function(){return d.inRange(g.state.options[b.option_name],b.min,b.max+1)?!0:(a.growl.error({message:"Only numbers between "+b.min+" to "+b.max+" is allowed for "+b.name+"!"}),!1)}),c},color:function(b){i.options[b.option_name]=b["default"];var c=a("<input type='button' class='stroke' rv-colorpicker='options."+b.option_name+"'>").button();return c.css("background",b["default"]),c},strokeWidth:function(b){i.options[b.option_name]=b["default"];var c=a('							<select rv-selectmenu="options.'+b.option_name+' | parseInt" rv-selectmenu-width="150">                <option value="1">1</option>                <option value="2">2</option>                <option value="3">3</option>                <option value="4">4</option>                <option value="5">5</option>                <option value="6">6</option>                <option value="7">7</option>                <option value="8">8</option>                <option value="9">9</option>                <option value="10">10</option>              </select>');return c},dashStyle:function(b){i.options[b.option_name]=b["default"];var c=a('							<select class="dash" rv-ddslick="options.'+b.option_name+'">                <option value="Solid" data-imagesrc="images/dashstyle/Solid.svg" title="Solid"></option>                <option value="ShortDash" data-imagesrc="images/dashstyle/ShortDash.svg"></option>                <option value="ShortDot" data-imagesrc="images/dashstyle/ShortDot.svg"></option>                <option value="ShortDashDot" data-imagesrc="images/dashstyle/ShortDashDot.svg"></option>                <option value="ShortDashDotDot" data-imagesrc="images/dashstyle/ShortDashDotDot.svg"></option>                <option value="Dot" data-imagesrc="images/dashstyle/Dot.svg"></option>                <option value="Dash" data-imagesrc="images/dashstyle/Dash.svg"></option>                <option value="LongDash" data-imagesrc="images/dashstyle/LongDash.svg"></option>                <option value="DashDot" data-imagesrc="images/dashstyle/DashDot.svg"></option>                <option value="LongDashDot" data-imagesrc="images/dashstyle/LongDashDot.svg"></option>                <option value="LongDashDotDot" data-imagesrc="images/dashstyle/LongDashDotDot.svg"></option>              </select>');return c},appliedTo:function(b){i.options[b.option_name]=b["default"];var c=a('							<select rv-selectmenu="options.'+b.option_name+' | parseInt" rv-selectmenu-width="150">	              <option value="0">OPEN</option>	              <option value="1">HIGH</option>	              <option value="2">LOW</option>	              <option value="3" selected>CLOSE</option>              </select>						');return c},levels:function(b){i.options[b.option_name]=b["default"];var c=a('							<td colspan="2">								<div id="levels">									<table rv-level="options.levels" class="display">		                <thead>		                  <tr>		                    <td>Level</td>		                    <td>Stroke</td>		                    <td>Stroke width</td>		                    <td>Dash style</td>		                  </tr>		                </thead>		                <tbody>		                </tbody>		              </table>		             </div>	             </td>						'),d=a('							<tr>		            <td><button id="level_delete" rv-on-click="levels.delete">Delete level(s)</button></td>		            <td><button id="level_add" rv-on-click="levels.add">Add level</button></td>			        </tr>						');return h.append(d),c}};return i.description=e.description,i.options={},e.fields.forEach(function(a){k.row(a.name,k[a.type](a))}),i.levels={add:function(a,b){require(["indicator_levels"],function(a){a.open(f,function(a){b.options.levels.push(a[0])})})},"delete":function(b,c){var d=a.find(".levels_selected");0==d.length&&a.growl.error({message:"Select level(s) to delete!"});var e=c.options.levels.slice();a.each(d,function(b,c){e.splice(a(c).data("index")-b,1)}),c.options.levels=e}},b.binders.ddslick={priority:102,publishes:!0,bind:function(b){var c=this.publish;a(b).ddslick({imagePosition:"left",width:151,background:"white",onSelected:function(a){c(a.selectedData.value)}})},unbind:function(b){a(b).ddslick("destroy")}},b.binders.level={priority:102,publishes:!0,routine:function(b,c){return b=a(b),b.find("tr").each(function(b,c){0!=b&&a(c).remove()}),0==c.length?void b.append(a('<tr><td colspan="4"><div class="no-data">No data available in table</div></td></tr>')):void a.each(c,function(c,d){var e=a("		    				<tr>			    				<td>"+d.level+'</td>			    				<td><div style="background-color: '+d.stroke+';width:100%;height:20px;"></div></td>			    				<td>'+d.strokeWidth+'</td>			    				<td><div style="width:50px;overflow:hidden;margin: 0 auto;height: 20px;"><img src="images/dashstyle/'+d.dashStyle+'.svg" /></div</td>			    			</tr>		    			');e.click(function(){a(this).toggleClass("levels_selected")}).data("index",c),b.append(e)})}},b.formatters.parseInt={publish:function(a){return parseInt(a)}},this.checks=j,i}},{key:"unbind",value:function(){this.view&&this.view.unbind(),this.view=null}}]),e}();return{open:function(a,b,c){return new e(a,b,c)}}});