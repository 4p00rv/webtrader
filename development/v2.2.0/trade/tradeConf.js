define(["exports","lodash","jquery","moment","../websockets/binary_websockets","../common/rivetsExtra","../charts/chartingRequestMap","text!../trade/tradeConf.html","binary-longcode","css!../trade/tradeConf.css"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var k=j(b),l=j(c),m=j(d),n=j(e),o=j(f),p=j(g),q=j(h);o["default"].binders["tick-chart"]={priority:65,bind:function(a){var b=this.model;a.chart=new Highcharts.Chart({title:"",credits:{enabled:!1},chart:{type:"line",renderTo:a,backgroundColor:null,width:1*(a.getAttribute("width")||350),height:1*(a.getAttribute("height")||120)},tooltip:{formatter:function(){var a=b.array[this.x-1];return a&&a.tooltip||!1}},xAxis:{type:"linear",min:1,max:1*a.getAttribute("tick-count")+1,labels:{enabled:!1}},yAxis:{labels:{align:"left",x:0},title:"",gridLineWidth:0},series:[{data:[]},{type:"scatter",marker:{enabled:!1},data:[]}],plotOptions:{scatter:{enableMouseTracking:!1}},exporting:{enabled:!1,enableImages:!1},legend:{enabled:!1}})},routine:function(a,b){var c=this.model,d=function(a,b){a.xAxis[0].addPlotLine({value:b.value,id:b.id||b.value,label:{text:b.label||"label"},color:b.color||"#e98024",width:b.width||2})},e=function(a,b){a.yAxis[0].addPlotLine({id:b.id||b.label,value:b.value,label:{text:b.label,align:"center"},color:"green",width:2}),a.series[1].addPoint([1,1*b.value])},f=b.length;if(0!=f){var g=k["default"].last(b);a.chart.series[0].addPoint([f,1*g.quote]);var h=c.getPlotX();h&&d(a.chart,h);var i=c.getPlotY();i&&a.chart.yAxis[0].removePlotLine(i.id),i&&e(a.chart,i)}}};var r=[];n["default"].events.on("tick",function(a){var b=a.tick;b.quote*=1,b.epoch*=1,r.push(b),r.length>1e3&&r.shift()});var s=function(a,b){var c=1*b.tick_count,d=b.symbol,e=(1*a.buy.purchase_time,null),f=function(f){if(-1===k["default"].findIndex(a.ticks.array,function(a){return 1*a.epoch===1*f.epoch})&&c>0){var g=p["default"].digits_after_decimal(b.pip,d);a.ticks.array.push({quote:f.quote,epoch:f.epoch,number:a.ticks.array.length+1,tooltip:m["default"].utc(1e3*f.epoch).format("dddd, MMM D, HH:mm:ss")+"<br/>"+b.symbol_name+" "+f.quote.toFixed(g),decimal_digits:g}),--c,0===c&&(a.ticks.update_status(),a.buy.update(),a.back.visible=!0,n["default"].events.off("proposal_open_contract",e),n["default"].proposal_open_contract.forget(b.contract_id)),"digits"!==a.ticks.category.contract_category&&a.ticks.update_status()}},g=null,h=null,i=!1,j=function l(){i=!1,r.filter(function(a){return a.symbol===b.symbol&&1*a.epoch>=g&&1*a.epoch<=h}).forEach(f),c>0&&(i=!0,setTimeout(l,300))};e=n["default"].events.on("proposal_open_contract",function(a){var c=a.proposal_open_contract;c.contract_id===b.contract_id&&(g=c.entry_tick_time?1*c.entry_tick_time:g,h=c.exit_tick_time?1*c.exit_tick_time:c.date_expiry?1*c.date_expiry:h,!i&&g&&h&&j())})},t=a.init=function(a,b,c,d){var e=l["default"](q["default"]).i18n(),f=a.buy,g=p["default"].digits_after_decimal(b.pip,b.symbol),h=local_storage.get("currency"),j=(local_storage.get("i18n")||{value:"en"}).value,m=local_storage.get("active_symbols"),r=new i.Longcode(m,j,h);b.getbarrier=function(a){var c=1*a.quote;return b.barrier&&!k["default"](["rise","fall"]).includes(b.category_display.name)&&(c+=1*b.barrier),c.toFixed(g)};var t={title:{text:"Contract Confirmation".i18n()},buy:{barrier:null,message:r.get(f.shortcode),balance_after:f.balance_after,buy_price:f.buy_price,purchase_time:f.purchase_time,start_time:f.start_time,transaction_id:f.transaction_id,payout:f.payout,currency:b.currency,potential_profit:f.payout-f.buy_price,potential_profit_text:"Profit".i18n(),show_result:!1},spreads:{amount_per_point:f.amount_per_point||"0",stop_loss_level:f.stop_loss_level||"0",stop_profit_level:f.stop_profit_level||"0"},ticks:{array:[],average:function(){for(var a=t.ticks,b=a.array,c=0,d=0;d<b.length;++d)c+=1*b[d].quote;var e=c/(b.length||1);return e},getPlotX:function(){var a=t.ticks,b=a.array.length;return 1===b?{value:b,label:"Entry Spot".i18n()}:b===a.tick_count?{value:b,label:"Exit Spot".i18n()}:null},getPlotY:function(){var a=t.ticks,c=a.array.length,d=a.array[c-1];if("callput"===a.category.contract_category&&1===c){var e=b.getbarrier(d);return t.buy.barrier=e,{value:1*e,label:"Barrier (".i18n()+e+")",id:"plot-barrier-y"}}if("asian"===a.category.contract_category){var f=a.average().toFixed(g+1);return{value:f,label:"Average (".i18n()+f+")",id:"plot-barrier-y"}}return null},tick_count:b.tick_count,value:(b.digits_value||"0")+"",category:b.category,category_display:b.category_display,status:"waiting",chart_visible:b.show_tick_chart},arrow:{visible:!b.show_tick_chart&&"digits"!==b.category.contract_category},back:{visible:!1}};t.buy.update=function(){var a=t.ticks.status;t.title.text={waiting:"Contract Confirmation".i18n(),won:"This contract won".i18n(),lost:"This contract lost".i18n()}[a],"lost"===a&&(t.buy.potential_profit=-t.buy.buy_price,t.buy.payout=0,t.buy.potential_profit_text="Lost"),"won"===a&&(t.buy.balance_after=1*f.balance_after+1*t.buy.payout,n["default"].sell_expired()),t.buy.show_result=!0},t.ticks.update_status=function(){var a=p["default"].digits_after_decimal(b.pip,b.symbol),c=(k["default"].head(t.ticks.array).quote.toFixed(a)+"",k["default"].last(t.ticks.array).quote.toFixed(a)+""),d=b.getbarrier(k["default"].head(t.ticks.array))+"",e=t.ticks.value+"",f=t.ticks.average().toFixed(5),g=t.ticks.category,h=t.ticks.category_display.sentiment,i={digits:{match:k["default"].last(c)===e,differ:k["default"].last(c)!==e,over:1*k["default"].last(c)>1*e,under:1*k["default"].last(c)<1*e,odd:1*k["default"].last(c)%2===1,even:1*k["default"].last(c)%2===0},callput:{up:1*c>1*d,down:1*d>1*c},asian:{up:1*c>f,down:f>1*c}};t.ticks.status=i[g.contract_category][h]?"won":"lost"},t.back.onclick=function(){return d(e)},t.arrow.onclick=function(a){var c=l["default"](a.target);c.hasClass("disabled")||(c.addClass("disabled"),require(["viewtransaction/viewTransaction"],function(a){a.init(b.contract_id,b.transaction_id).then(function(){return c.removeClass("disabled")})}))};o["default"].bind(e[0],t);t.arrow.visible?t.back.visible=!0:s(t,b),c(e)};a["default"]={init:t}});