define(["exports","jquery","../windows/windows","../websockets/binary_websockets","lodash","text!./statement.html","../viewtransaction/viewTransaction","binary-longcode","datatables","jquery-growl","css!./statement.css"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var j=i(b),k=i(c),l=i(d),m=i(e),n=i(f),o=i(g),p=null,q=null,r=null,s=local_storage.get("currency"),t=a.init=function(a){a.click(function(){p?p.moveToTop():l["default"].cached.authorize().then(x)["catch"](function(a){return void 0})})},u=!1,v=!1,w=function(a){var b=j["default"]("#"+q.attr("id")+"_processing").css("top","200px").show();u=!0;var c=(local_storage.get("i18n")||{value:"en"}).value,d=local_storage.get("currency")||"USD",e=local_storage.get("active_symbols"),f=new h.Longcode(e,c,d),g={statement:1,description:1};if("string"==typeof a){g.date_from=yyyy_mm_dd_to_epoch(a,{utc:!0});var i=Date.UTC(1970,0,1,23,59,59)/1e3;g.date_to=g.date_from+i,q.api().rows().remove(),v=!0}else g.limit=50,(v||a.clear)&&(q.api().rows().remove(),v=!1),g.offset=q.api().column(0).data().length;var k=function(a){var c=a.statement&&a.statement.transactions||[],e="View".i18n(),g=c.map(function(a){{var b=m["default"](["buy","sell"]).includes(a.action_type)?"":'class="button-disabled"',c="<button "+b+">"+e+"</button>";1*a.amount}return[epoch_to_string(a.transaction_time,{utc:!0}),a.transaction_id,m["default"].capitalize(a.action_type),/(Buy|Sell)/i.test(a.action_type)?f.get(a.shortcode):a.longcode,(1*a.amount).toFixed(2),"<b>"+formatPrice(a.balance_after,d)+"</b>",c,a]});q.api().rows.add(g),q.api().draw(),u=!1,b.hide()};l["default"].send(g).then(k)["catch"](function(a){k({}),j["default"].growl.error({message:a.message})})},x=function(){p=k["default"].createBlankWindow(j["default"]("<div/>"),{title:"Statement".i18n(),width:700,height:400,close:function(){q&&q.DataTable().destroy(!0),p&&p.remove(),p=null},refresh:function(){r.clear(),w({clear:!0})},"data-authorized":"true"}),p.track({module_id:"statement",is_unique:!0,data:null}),q=j["default"](n["default"]).i18n(),q.appendTo(p),q=q.dataTable({data:[],columnDefs:[{targets:4,createdCell:function(a,b){var c=0>b?"red":b>0?"green":"bold";c&&j["default"](a).addClass(c),a.textContent=formatPrice(b,s)}}],paging:!1,ordering:!1,searching:!0,processing:!0}),q.closest(".ui-dialog-content").addClass("hide-search-input").addClass("statement-dialog-content"),q.api().columns().every(function(){var a=this;j["default"]("input",this.header()).on("keyup change",function(){a.search()!==this.value&&a.search(this.value).draw()})}),r=p.addDateToHeader({title:"Jump to: ",date:null,changed:w,cleared:w}),p.on("click",y),p.dialog("open"),w({clear:!0}),p.scroll(function(){var a=p.scrollTop(),b=p.innerHeight(),c=p[0].scrollHeight,d=(a+b)/c;d>.75&&!u&&!v&&w({clear:!1})})},y=function(a){var b=a.target,c=j["default"](b);if("BUTTON"===b.tagName&&!c.hasClass("button-disabled")){var d=b.parentElement.parentElement,e=q.api().row(d).data();e=m["default"].last(e),c.addClass("button-disabled"),o["default"].init(e.contract_id,e.transaction_id).then(function(){return c.removeClass("button-disabled")})["catch"](function(){})}};a["default"]={init:t}});