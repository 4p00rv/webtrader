{"version":3,"sources":["../../../../../src/charts/indicators/indicatorBuilder.es6"],"names":["before_add_callback","closeDialog","dialog","remove","init","chart","indicator","require","$html","state","id","fields","levels","formula","description","cdl_indicator","dash_styles","map","name","dash","url","update_value","row","value","level","marginTop","visible","add","forEach","field","key","label","text","values","push","cancel","inx","indexOf","splice","e","btn","target","find","next","height","content","animate","scrollTop","prop","editable","current_options","opt_val","opt_key","cloneDeep","view","bind","options","title","long_display_name","autoOpen","resizable","width","modal","my","at","of","window","dialogClass","buttons","click","JSON","parse","stringify","type","length","color","from","minBy","to","maxBy","cdlIndicatorCode","onSeriesID","series","addIndicator","icons","close","minimize","maximize","dialogExtend","extend","maximizable","minimizable","collapsable","open","containerIDWithHash","before_add_cb","highcharts"],"mappings":"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","file":"indicatorBuilder.js","sourcesContent":["/**\n * Created by arnab on 3/1/15.\n */\n\nimport $ from \"jquery\";\nimport _ from \"lodash\";\nimport rv from '../../common/rivetsExtra';\nimport 'jquery-ui';\nimport 'color-picker';\nimport 'ddslick';\n\nlet before_add_callback = null;\n\nconst closeDialog = (dialog) => {\n    dialog.dialog(\"destroy\").remove();\n}\n\nconst init = async (chart, indicator) => {\n\n    require(['css!charts/indicators/indicatorBuilder.css']);\n\n    let [$html] = await require(['text!charts/indicators/indicatorBuilder.html']);\n\n    const state = {\n      id: indicator.id,\n      fields: indicator.fields,\n      levels: indicator.levels, /* optional */\n      formula: indicator.formula, /* optional */\n      description: indicator.description,\n      cdl_indicator: indicator.cdl_indicator, /* optional (cdl indicators only) */\n      dash_styles: [\n        \"Solid\", \"ShortDash\", \"ShortDot\", \"ShortDashDot\", \"ShortDashDotDot\",\n        \"Dot\", \"Dash\", \"LongDash\", \"DashDot\", \"LongDashDot\", \"LongDashDotDot\"\n      ].map(dash => ({ name: dash, url: `images/dashstyle/${dash}.svg`})),\n      update_value(row, value) {\n        row.value = value;\n      },\n      level: {\n        dialog: {\n          marginTop: '0px',\n          visible: false,\n          add: () => {\n            const fields = state.levels.fields;\n            const level = { };\n            fields.forEach(field => level[field.key] = field.value);\n            level.label = { text: level.value };\n            state.levels.values.push(level);\n            state.level.dialog.visible = false;\n          },\n          cancel: () => { state.level.dialog.visible = false; }\n       },\n        remove: row => {\n          const values = state.levels.values;\n          const inx = values.indexOf(row);\n          inx !== -1 && values.splice(inx, 1);\n        },\n        add: (e) => {\n          const btn = $(e.target);\n          const marginTop =  $html.find('.levels-tr').next().height() - 3;\n          state.level.dialog.marginTop = marginTop*-1 + 'px';\n          state.level.dialog.visible = !state.level.dialog.visible;\n          if(state.level.dialog.visible) {\n            const content = $('.indicator-builder');\n            content.animate({ scrollTop: content.prop('scrollHeight')}, 700);\n          }\n        }\n      }\n    }\n\n    if(indicator.editable && indicator.current_options) {\n      _.forEach(indicator.current_options, (opt_val, opt_key) => {\n        const field = _.find(state.fields, {key: opt_key})\n        field && (field.value = opt_val);\n      });\n\n      if(indicator.current_options.levels) {\n        state.levels.values = _.cloneDeep(indicator.current_options.levels);\n      }\n    }\n\n\n    $html = $($html);\n    const view = rv.bind($html[0], state);\n\n    const options = {\n        title: indicator.long_display_name,\n        autoOpen: false,\n        resizable: false,\n        width: 350,\n        height: 400,\n        modal: true,\n        my: 'center',\n        at: 'center',\n        of: window,\n        dialogClass:'indicator-builder-ui-dialog',\n        buttons: [\n            {\n                text: \"OK\",\n                click: () => {\n                    const options = { };\n                    if(!indicator.cdl_indicator) { /* normal indicator */\n                      if(state.levels) {\n                        options.levels = JSON.parse(JSON.stringify(state.levels.values));\n                      }\n                      state.fields.forEach(field => {\n                         if(field.type !== 'plotcolor') {\n                            options[field.key] = field.value\n                            return;\n                         }\n                         options[field.key] = [];\n                         if(options.levels && options.levels.length > 0) {\n                            options[field.key].push({\n                               color: field.value,\n                               from: _.minBy(options.levels, 'value').value,\n                               to: _.maxBy(options.levels, 'value').value\n                            });\n                         }\n                      });\n                    }\n                    else { /* cdl indicator */\n                       options.cdlIndicatorCode = state.id;\n                       options.onSeriesID = chart.series[0].options.id\n                    }\n\n                   if(state.id === 'fractal') { /* special case */\n                       options.onSeriesID = chart.series[0].options.id\n                   }\n\n                    before_add_callback && before_add_callback();\n\n                    //Add indicator for the main series\n                    chart.series[0].addIndicator(state.id, options);\n\n                    closeDialog($html);\n                }\n            },\n            {\n                text: \"Cancel\",\n                click: () => closeDialog($html)\n            }\n        ],\n        icons: {\n            close: 'custom-icon-close',\n            minimize: 'custom-icon-minimize',\n            maximize: 'custom-icon-maximize'\n        }\n    };\n    $html.dialog(options)\n      .dialogExtend(_.extend(options, {maximizable:false, minimizable:false, collapsable:false}));\n    return $html;\n}\n\n/**\n * @param indicator - indicator options from indicators.json\n * @param containerIDWithHash - containerId where indicator needs to be added\n * @param before_add_cb - callback that will be called just before adding the indicator\n */\nexport const open = async (indicator, containerIDWithHash, before_add_cb) => {\n    before_add_callback = before_add_cb || before_add_callback;\n\n    const chart = $(containerIDWithHash).highcharts();\n    await init(chart, indicator);\n\n    $(\".indicator-builder\").dialog('open');\n    $(\".indicator-builder\").animate({ scrollTop: 0 }, 800);\n}\nexport default { open, };\n"]}