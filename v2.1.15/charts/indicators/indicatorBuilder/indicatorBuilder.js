"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();define(["jquery","common/rivetsExtra","text!charts/indicators/indicators.json","lodash","text!charts/indicators/indicatorBuilder/indicatorBuilder.html","windows/windows","ddslick","jquery-growl","css!charts/indicators/indicatorBuilder/indicatorBuilder.css"],function(a,b,c,d,e,f){var g=function(){function g(a,b,d){_classCallCheck(this,g);var e=JSON.parse(c)[b];this.init(a,e,d)}return _createClass(g,[{key:"init",value:function(c,d,g){var h=this,i=a(e).i18n(),j=f.createBlankWindow(i,{title:d.long_display_name,resizable:!1,collapsable:!1,minimizable:!1,maximizable:!1,autoOpen:!0,dialogClass:"ind-ui-dialog",buttons:[{text:"OK",click:function(){var b=h.state.options,e=function(){var a=h.state.checks;return a?1===a.length?a[0]():a.reduce(function(a,b){return a="function"==typeof a?a():a,b=b(),a&&b}):!0};e()&&(g&&g(),a(c).highcharts().series[0].addIndicator(d.short_display_name.toLowerCase(),b),a(this).dialog("close"))}},{text:"Cancel",click:function(){a(this).dialog("close")}}],close:function(){h.unbind()}});this.state=this.init_state(j,d,c),this.view=b.bind(i[0],this.state)}},{key:"init_state",value:function(c,e,f){var g=this,h=e;return h.options={},h.dialogId="#"+c[0].id,h.checks=[],h.levels={add:function(a,b){require(["indicator_levels"],function(a){a.open(f,function(a){b.options.levels.push(a[0])})})},"delete":function(b,c){var d=a.find(".levels_selected");0==d.length&&a.growl.error({message:"Select level(s) to delete!"});var e=c.options.levels.slice();a.each(d,function(b,c){e.splice(a(c).data("index")-b,1)}),c.options.levels=e}},b.binders.ddslick={priority:99,publishes:!0,bind:function(b){var c=this.publish;a(b).ddslick({imagePosition:"left",width:151,background:"white",onSelected:function(a){c(a.selectedData.value)}})},unbind:function(b){a(b).ddslick("destroy")}},b.binders.level={priority:99,publishes:!0,routine:function(b,c){return c?(b=a(b),b.find("tr").each(function(b,c){0!=b&&a(c).remove()}),0==c.length?void b.append(a('<tr><td colspan="4"><div class="no-data">No data available in table</div></td></tr>')):void a.each(c,function(c,d){var e=a("		    				<tr>			    				<td>"+d.level+'</td>			    				<td><div style="background-color: '+d.stroke+';width:100%;height:20px;"></div></td>			    				<td>'+d.strokeWidth+'</td>			    				<td><div style="width:50px;overflow:hidden;margin: 0 auto;height: 20px;"><img src="images/dashstyle/'+d.dashStyle+'.svg" /></div</td>			    			</tr>		    			');e.click(function(){a(this).toggleClass("levels_selected")}).data("index",c),b.append(e)})):void 0}},b.binders.check=function(b,c){g.state.checks.push(function(){return d.inRange(g.state.options[c.option_name],c.min,c.max+1)?!0:(a.growl.error({message:"Please enter a value between "+c.min+" and "+c.max+" for <b>"+c.name+"</b>!"}),!1)})},b.formatters.parseInt={publish:function(a){return parseInt(a)}},b.formatters.copy_option={read:function(a,b){return a=a?a:b["default"],g.state.options[b.option_name]=a,a}},h}},{key:"unbind",value:function(){this.view&&this.view.unbind(),this.view=null}}]),g}();return{open:function(a,b,c){return new g(a,b,c)}}});